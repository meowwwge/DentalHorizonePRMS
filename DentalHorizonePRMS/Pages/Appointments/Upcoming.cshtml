@page
@model DentalHorizonePRMS.Pages.Appointments.UpcomingModel
@{
    ViewData["Title"] = "Upcoming Appointments";
    Layout = "_Layout";
}

<div class="min-h-[calc(100vh-80px)] bg-gradient-to-br from-white via-gray-50 to-gray-100 text-gray-800 px-6 py-6 font-poppins">

    <!-- Header -->
    <div class="flex items-center gap-3 mb-6">
        <svg class="w-7 h-7 text-orange-500" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        <h1 class="text-3xl font-bold text-gray-800">Upcoming Appointments</h1>
    </div>

    <!-- Search -->
    <input type="text" id="searchUpcoming" placeholder="Search patient..."
           class="border rounded px-3 py-2 w-64" />


    <!-- Table -->
    <div class="overflow-x-auto bg-white rounded-xl shadow-md border border-gray-200">
        <table class="min-w-full text-sm text-left text-gray-700">
            <thead class="bg-gray-100 text-xs uppercase text-gray-600">
                <tr>
                    <th class="px-4 py-3">Name</th>
                    <th class="px-4 py-3">Age</th>
                    <th class="px-4 py-3">Telephone</th>
                    <th class="px-4 py-3">Next Appointment</th>
                    <th class="px-4 py-3">Service</th>
                    <th class="px-4 py-3">Complaint</th>
                    <th class="px-4 py-3">Status</th>
                    <th class="px-4 py-3">Actions</th>
                </tr>
            </thead>
            <tbody id="upcomingTable"></tbody>
        </table>
    </div>
</div>

<!-- Reschedule Modal -->
<div id="rescheduleModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
        <h2 class="text-lg font-semibold mb-4">Reschedule Appointment</h2>

        <label for="newDate" class="block text-sm font-medium text-gray-700 mb-2">Select new date:</label>
        <input type="date" id="newDate" class="border rounded px-3 py-2 w-full mb-4" />

        <div class="flex justify-end space-x-2">
            <button id="cancelReschedule" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
            <button id="confirmReschedule" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Confirm</button>
        </div>
    </div>
</div>

<!-- Cancel Modal -->
<div id="cancelModal" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
        <h2 class="text-lg font-semibold mb-4">Cancel Appointment</h2>
        <p class="mb-6">Are you sure you want to cancel this appointment?</p>
        <div class="flex justify-end space-x-2">
            <button id="confirmCancel" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
                Yes, Cancel
            </button>
            <button id="closeCancel" class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">
                No
            </button>
        </div>
    </div>
</div>


<!-- Success Modal -->
<div id="successModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
        <h2 class="text-lg font-semibold mb-4">Success</h2>
        <p class="modal-message">Patient added successfully!</p>
        <div class="flex justify-end">
            <button onclick="closeSuccessModal()" class="px-4 py-2 bg-blue-600 text-white rounded">Close</button>
        </div>
    </div>
</div>

<!-- Error Modal -->
<div id="errorModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg p-6 w-96">
        <h2 class="text-lg font-semibold mb-4">Error</h2>
        <p class="modal-message">Something went wrong.</p>
        <div class="flex justify-end">
            <button onclick="closeErrorModal()" class="px-4 py-2 bg-red-600 text-white rounded">Close</button>
        </div>
    </div>
</div>


<script src="~/js/patientFunction.js"></script>
<script src="~/js/patientFormLogic.js"></script>
<script src="~/js/modals.js"></script>

<script>
    async function loadUpcomingAppointments() {
        const upcoming = await fetch('/api/Patient/upcoming-appointments').then(res => res.json());
        renderUpcoming(upcoming);
    }
    document.addEventListener("DOMContentLoaded", loadUpcomingAppointments);
</script>